// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   // Hash da senha
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relacionamento com eventos criados
  events        Event[]
  // Relacionamento com convites recebidos
  eventInvites  EventInvite[]

  @@index([email])
  @@map("users")
}

model Event {
  id                Int      @id @default(autoincrement())
  title             String
  description       String?
  startDate         DateTime
  endDate           DateTime
  location          String?
  color             String   @default("#3788d8") // Cor padrão azul

  // Recorrência
  isRecurring       Boolean  @default(false)
  recurrenceRule    String?  // Formato RRULE
  recurrenceEndDate DateTime?

  // Lembretes (em minutos antes do evento)
  reminders         Json?    // Array de números: [5, 15, 30]

  // Relacionamentos
  userId            Int
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  invites           EventInvite[]

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
  @@index([startDate])
  @@map("events")
}

enum InviteStatus {
  PENDING
  ACCEPTED
  DECLINED
}

model EventInvite {
  id        Int          @id @default(autoincrement())
  eventId   Int
  event     Event        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId    Int
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  status    InviteStatus @default(PENDING)
  canEdit   Boolean      @default(false) // Sempre false - apenas visualização
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  @@unique([eventId, userId]) // Um usuário só pode ser convidado uma vez por evento
  @@index([userId])
  @@index([eventId])
  @@map("event_invites")
}
